<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>Rolling PIC Produk</title>

<style>
/* ===== BASE ===== */
body {
  font-family: Arial, sans-serif;
  padding: 20px;
  background: #f5f7fa;
}

h1 {
  margin-bottom: 10px;
}

textarea {
  width: 100%;
  height: 120px;
  margin-bottom: 15px;
  padding: 10px;
  font-family: monospace;
}

button {
  padding: 12px 18px;
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
}

button:disabled {
  background: #94a3b8;
  cursor: not-allowed;
}

/* ===== TABLE ===== */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  background: white;
}

th, td {
  border: 1px solid #ddd;
  padding: 10px;
}

th {
  background: #f1f5f9;
}

/* ===== LOADING ===== */
.loading {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 15px;
  font-weight: bold;
}

.spinner {
  width: 22px;
  height: 22px;
  border: 3px solid #cbd5f5;
  border-top: 3px solid #2563eb;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  100% { transform: rotate(360deg); }
}

/* ===== SHUFFLE TEXT ===== */
.shuffle {
  animation: pulse 0.3s infinite;
  color: #2563eb;
  font-weight: bold;
}

@keyframes pulse {
  0% { opacity: .3; }
  50% { opacity: 1; }
  100% { opacity: .3; }
}

/* ===== COUNTDOWN ===== */
.countdown-wrapper {
  display: flex;
  justify-content: center;
  margin: 30px 0;
}

.countdown-circle {
  position: relative;
  width: 160px;
  height: 160px;
}

svg {
  transform: rotate(-90deg);
}

circle {
  fill: none;
  stroke-width: 10;
}

.bg {
  stroke: #e5e7eb;
}

.progress {
  stroke: #2563eb;
  stroke-linecap: round;
  stroke-dasharray: 440;
  stroke-dashoffset: 0;
  transition: stroke .3s;
}

.countdown-number {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
  font-weight: bold;
  font-family: monospace;
  color: #2563eb;
  animation: pulse 1s infinite;
}

.countdown-warning {
  color: #dc2626;
  animation: dangerPulse .5s infinite;
}

@keyframes dangerPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.3); }
  100% { transform: scale(1); }
}
</style>
</head>

<body>

<h1>üîÑ Rolling PIC Produk</h1>

<h3>Daftar Developer</h3>
<textarea id="developers">
Andre
Fandi
Valdi
Risman
Aris
Yanto
Ijunn
</textarea>

<h3>Daftar Produk (Nama Produk | PIC Lama)</h3>
<textarea id="products">
XecureBrowser Desktop Client | Andre
XecureBrowser Mobile Client | Andre
Whitelist Server | Andre
XDR | Arint
Threat Map | Valdi
Xnetz | Ijun
</textarea>

<button id="shuffleBtn" onclick="generateRolling()">üé≤ Kocok Data</button>

<!-- COUNTDOWN -->
<div id="countdownWrapper" class="countdown-wrapper" style="display:none;">
  <div class="countdown-circle">
    <svg width="160" height="160">
      <circle class="bg" cx="80" cy="80" r="70"></circle>
      <circle class="progress" cx="80" cy="80" r="70"></circle>
    </svg>
    <div id="countdownNumber" class="countdown-number">30</div>
  </div>
</div>

<!-- LOADING -->
<div id="loading" class="loading" style="display:none;">
  <div class="spinner"></div>
  <span>Mengocok data PIC...</span>
</div>

<!-- RESULT -->
<table id="resultTable" style="display:none;">
  <thead>
    <tr>
      <th>No</th>
      <th>Nama Produk</th>
      <th>PIC Sebelumnya</th>
      <th>PIC Baru</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
/* ===== UTIL ===== */
function randomItem(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function getFinalPIC(devs, exclude) {
  const filtered = devs.filter(d => d !== exclude);
  return filtered.length ? randomItem(filtered) : exclude;
}

/* ===== COUNTDOWN ===== */
function startCountdown(duration, onFinish) {
  const wrapper = document.getElementById("countdownWrapper");
  const numberEl = document.getElementById("countdownNumber");
  const progressEl = document.querySelector(".progress");

  const circumference = 440;
  let timeLeft = duration;

  wrapper.style.display = "flex";
  numberEl.textContent = timeLeft;
  progressEl.style.strokeDashoffset = 0;
  progressEl.style.stroke = "#2563eb";
  numberEl.classList.remove("countdown-warning");

  const interval = setInterval(() => {
    timeLeft--;
    numberEl.textContent = timeLeft;

    const offset = circumference - (timeLeft / duration) * circumference;
    progressEl.style.strokeDashoffset = offset;

    if (timeLeft <= 5) {
      numberEl.classList.add("countdown-warning");
      progressEl.style.stroke = "#dc2626";
    }

    if (timeLeft <= 0) {
      clearInterval(interval);
      wrapper.style.display = "none";
      onFinish();
    }
  }, 1000);
}

/* ===== MAIN ===== */
function generateRolling() {
  const btn = document.getElementById("shuffleBtn");
  const loading = document.getElementById("loading");
  const table = document.getElementById("resultTable");
  const tbody = table.querySelector("tbody");

  const developers = document.getElementById("developers")
    .value.split("\n").map(d => d.trim()).filter(Boolean);

  const products = document.getElementById("products")
    .value.split("\n").map(p => p.trim()).filter(Boolean);

  btn.disabled = true;
  btn.textContent = "Mengocok...";
  loading.style.display = "flex";
  table.style.display = "table";
  tbody.innerHTML = "";

  // initial rows
  products.forEach((line, i) => {
    const [product, oldPic] = line.split("|").map(s => s.trim());
    tbody.innerHTML += `
      <tr>
        <td>${i + 1}</td>
        <td>${product}</td>
        <td>${oldPic}</td>
        <td class="shuffle">‚è≥</td>
      </tr>`;
  });

  // fake shuffle
  const shuffleInterval = setInterval(() => {
    [...tbody.querySelectorAll(".shuffle")].forEach(cell => {
      cell.textContent = randomItem(developers);
    });
  }, 120);

  // countdown + final result
  startCountdown(30, () => {
    clearInterval(shuffleInterval);
    tbody.innerHTML = "";

    products.forEach((line, i) => {
      const [product, oldPic] = line.split("|").map(s => s.trim());
      const newPic = getFinalPIC(developers, oldPic);

      tbody.innerHTML += `
        <tr>
          <td>${i + 1}</td>
          <td>${product}</td>
          <td>${oldPic}</td>
          <td><strong>${newPic}</strong></td>
        </tr>`;
    });

    loading.style.display = "none";
    btn.disabled = false;
    btn.textContent = "üé≤ Kocok Data";
  });
}
</script>

</body>
</html>
